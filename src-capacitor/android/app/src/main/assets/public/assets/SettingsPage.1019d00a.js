import{c as s,Q as p,a as c,d as M,b as D}from"./QDialog.2982e651.js";import{Q as q}from"./QCard.5c7dff5f.js";import{Q as i}from"./QCardSection.b9a121b1.js";import{Q as C}from"./QInput.269eeae8.js";import{aJ as j,a0 as J,a as W,r as v,m as Y,y as r,z as g,B as l,a5 as P,a6 as Q,C as e,D as o,w as n,a4 as $,Q as N,a9 as G,E,a3 as H,I as X,aK as Z,R as _,aL as ee}from"./index.904fb14a.js";import{Q as L}from"./QSeparator.a15088f4.js";import{Q as z}from"./QCardActions.d2332bc6.js";import{Q as le}from"./QPage.91e185e6.js";import{C as U}from"./ClosePopup.be3b6694.js";import{u as ae}from"./use-quasar.c5871871.js";import"./use-dark.33053ea6.js";import"./use-timeout.a1378caa.js";import"./scroll.8ba91029.js";import"./uid.42677368.js";const te={key:0},oe={key:1},ue={key:0},se={key:1},re={key:2},ne=H("div",{class:"text-h6"},"Log out",-1),Ve={__name:"SettingsPage",setup(de){const B="0.0.1",h=ae(),O=j(),m=J();W(async()=>{try{m.userFetched||await m.fetchUser()}catch(a){console.error("await momentsStore.fetchUser() error:",a)}});const y=v(""),f=v(""),x=v(""),d=v(!0),k=v(!0),T=[a=>a&&a.length>0||"Please type your name"],K=[a=>a&&a.length>0||"Please type something",a=>/.+@.+\..+/.test(a)||"E-mail must be valid"],I=[a=>a&&a.length>0||"Please type something",a=>a.length>=6||"Password must be at least 6 characters"],V=v(!1),S=v(!1),b=v(null),w=v(null),R=a=>{y.value=a,f.value=a==="password"?"":m.user[a],V.value=!0,X(()=>{a==="password"?b.value.$el.querySelector("input").focus():w.value.$el.querySelector("input").focus()})};Y(V,a=>{a||(y.value="",f.value="",x.value="",d.value=!0,k.value=!0)});const A=async()=>{try{if(b.value&&(b.value.validate(),b.value.hasError)){console.log("oldPwdInputRef.value.hasError");return}if(w.value.validate(),w.value.hasError){console.log("mainInputRef.value.hasError");return}await m.updateUser({[y.value]:f.value,oldPassword:x.value}),V.value=!1,h.notify({icon:"done",color:"positive",message:y.value==="displayName"?"Name updated":y.value==="email"?"Email updated":"Password updated"})}catch(a){console.log(a),a.code==="auth/wrong-password"?(d.value=!1,b.value.$el.querySelector("input").focus(),h.notify({icon:"error",color:"negative",message:"Wrong password"})):a.code==="auth/weak-password"?(k.value=!1,w.value.$el.querySelector("input").focus(),h.notify({icon:"error",color:"negative",message:"Password should be at least 6 characters"})):h.notify({icon:"error",color:"negative",message:a.message})}},F=()=>{Z(ee).then(()=>{setTimeout(()=>{m.$reset(),O.push("/login"),console.log("logged out")},10)}).catch(a=>{console.log("Error logging out",a)}),S.value=!1};return(a,t)=>(r(),g(le,{class:"q-mx-auto q-pa-md",style:{"max-width":"600px"}},{default:l(()=>[!P(m)||!P(m).user?(r(),Q("div",te)):(r(),Q("div",oe,[e(M,{padding:""},{default:l(()=>[e(s,{header:""},{default:l(()=>[o("Account details")]),_:1}),e(q,{class:"bg-surface q-mb-md q-px-xs q-py-sm rounded-borders-14",flat:""},{default:l(()=>[n((r(),g(p,{clickable:"",onClick:t[0]||(t[0]=u=>R("displayName"))},{default:l(()=>[e(c,null,{default:l(()=>[e(s,{caption:""},{default:l(()=>[o(" Name ")]),_:1}),e(s,null,{default:l(()=>[o($(P(m).user.displayName),1)]),_:1})]),_:1})]),_:1})),[[_]]),n((r(),g(p,{clickable:"",onClick:t[1]||(t[1]=u=>R("email"))},{default:l(()=>[e(c,null,{default:l(()=>[e(s,{caption:""},{default:l(()=>[o(" Email ")]),_:1}),e(s,null,{default:l(()=>[o($(P(m).user.email),1)]),_:1})]),_:1})]),_:1})),[[_]]),n((r(),g(p,{clickable:"",onClick:t[2]||(t[2]=u=>R("password"))},{default:l(()=>[e(c,null,{default:l(()=>[e(s,{caption:""},{default:l(()=>[o(" Password ")]),_:1}),e(s,null,{default:l(()=>[o("*********")]),_:1})]),_:1})]),_:1})),[[_]])]),_:1}),e(q,{class:"bg-surface q-mb-md q-px-xs q-py-sm rounded-borders-14",flat:""},{default:l(()=>[n((r(),g(p,{clickable:""},{default:l(()=>[e(c,null,{default:l(()=>[e(s,null,{default:l(()=>[o("Language")]),_:1}),e(s,{caption:""},{default:l(()=>[o(" English ")]),_:1})]),_:1})]),_:1})),[[_]])]),_:1}),e(q,{class:"bg-surface q-mb-md q-px-xs q-py-sm rounded-borders-14",flat:""},{default:l(()=>[n((r(),g(p,{clickable:"",to:"/privacy-policy"},{default:l(()=>[e(c,null,{default:l(()=>[e(s,null,{default:l(()=>[o("Privacy policy")]),_:1})]),_:1})]),_:1})),[[_]]),n((r(),g(p,{clickable:"",to:"/terms"},{default:l(()=>[e(c,null,{default:l(()=>[e(s,null,{default:l(()=>[o("Terms of Service")]),_:1})]),_:1})]),_:1})),[[_]]),n((r(),g(p,{clickable:"",to:"/contact"},{default:l(()=>[e(c,null,{default:l(()=>[e(s,null,{default:l(()=>[o("Contact us")]),_:1})]),_:1})]),_:1})),[[_]])]),_:1}),n((r(),g(q,{class:"bg-surface q-mb-md q-px-xs q-py-sm rounded-borders-14",flat:"",clickable:"",onClick:t[3]||(t[3]=u=>S.value=!0)},{default:l(()=>[e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[e(s,null,{default:l(()=>[o("Log out")]),_:1})]),_:1})]),_:1})]),_:1})),[[_]]),e(p,null,{default:l(()=>[e(c,null,{default:l(()=>[e(s,null,{default:l(()=>[o("KifKaf version "+$(P(B)),1)]),_:1})]),_:1})]),_:1})]),_:1})])),e(D,{modelValue:V.value,"onUpdate:modelValue":t[12]||(t[12]=u=>V.value=u),position:"top"},{default:l(()=>[e(q,{class:"bg-surface"},{default:l(()=>[y.value==="displayName"?(r(),Q("div",ue,[e(i,{class:"text-h6"},{default:l(()=>[o("Change name")]),_:1}),e(i,null,{default:l(()=>[e(C,{ref_key:"mainInputRef",ref:w,class:"q-mx-sm q-mb-md",clearable:"",rounded:"",outlined:"",modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=u=>f.value=u),type:"text","bg-color":"surface-variant",label:"First & last name","lazy-rules":"",rules:T},null,8,["modelValue"])]),_:1})])):y.value==="email"?(r(),Q("div",se,[e(i,{class:"text-h6"},{default:l(()=>[o("Change email")]),_:1}),e(i,null,{default:l(()=>[o(" Enter your email address ")]),_:1}),e(C,{ref_key:"mainInputRef",ref:w,class:"q-mx-md q-mb-md",clearable:"",rounded:"",outlined:"",modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=u=>f.value=u),type:"email","bg-color":"surface-variant",placeholder:"jane.doe@mail.com","lazy-rules":"",rules:K},null,8,["modelValue"]),e(i,null,{default:l(()=>[o(" Enter your password to confirm ")]),_:1}),e(C,{ref_key:"oldPwdInputRef",ref:b,class:"q-mx-md q-mb-md",rounded:"",outlined:"",modelValue:x.value,"onUpdate:modelValue":t[7]||(t[7]=u=>x.value=u),label:"Password",type:d.value?"password":"text","bg-color":"surface-variant","lazy-rules":"",rules:I},{append:l(()=>[e(N,{name:d.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[6]||(t[6]=u=>d.value=!d.value)},null,8,["name"])]),_:1},8,["modelValue","type"])])):y.value==="password"?(r(),Q("div",re,[e(i,{class:"text-h6"},{default:l(()=>[o("Change Password")]),_:1}),e(i,null,{default:l(()=>[o(" Enter your existing password ")]),_:1}),e(C,{ref_key:"oldPwdInputRef",ref:b,class:"q-mx-md q-mb-md",rounded:"",outlined:"",modelValue:x.value,"onUpdate:modelValue":t[9]||(t[9]=u=>x.value=u),label:"Existing Password",type:d.value?"password":"text","bg-color":"surface-variant","lazy-rules":"",rules:I},{append:l(()=>[e(N,{name:d.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[8]||(t[8]=u=>d.value=!d.value)},null,8,["name"])]),_:1},8,["modelValue","type"]),e(i,null,{default:l(()=>[o(" Create a new password ")]),_:1}),e(C,{ref_key:"mainInputRef",ref:w,class:"q-mx-md q-mb-md",rounded:"",outlined:"",modelValue:f.value,"onUpdate:modelValue":t[11]||(t[11]=u=>f.value=u),label:"New Password",type:k.value?"password":"text","bg-color":"surface-variant","lazy-rules":"",rules:I},{append:l(()=>[e(N,{name:k.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[10]||(t[10]=u=>k.value=!k.value)},null,8,["name"])]),_:1},8,["modelValue","type"])])):G("",!0),e(L),e(z,{align:"right"},{default:l(()=>[n(e(E,{flat:"",rounded:"",label:"Cancel"},null,512),[[U]]),e(E,{rounded:"",color:"primary",onClick:A,padding:"5px 25px"},{default:l(()=>[o("Save")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:S.value,"onUpdate:modelValue":t[13]||(t[13]=u=>S.value=u)},{default:l(()=>[e(q,{class:"bg-surface"},{default:l(()=>[e(i,null,{default:l(()=>[ne]),_:1}),e(i,null,{default:l(()=>[o(" You will be returned to the login screen. ")]),_:1}),e(L),e(z,{align:"right"},{default:l(()=>[n(e(E,{flat:"",rounded:"",label:"Cancel",color:"primary"},null,512),[[U]]),n(e(E,{flat:"",rounded:"","data-cy":"logout-button",label:"Log out",color:"primary",onClick:F},null,512),[[U]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ve as default};
