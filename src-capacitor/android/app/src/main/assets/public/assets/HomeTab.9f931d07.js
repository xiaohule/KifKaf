import{Q as W,a as T,b as me,c as Y,d as J}from"./QDialog.2982e651.js";import{r as C,V as ee,k as K,X as te,c as b,h,Y as ae,Z as ve,g as ne,_ as fe,$ as he,a0 as G,a1 as O,a as E,o as le,y as v,z as x,Q as z,B as s,C as c,a2 as pe,R as oe,s as ge,m as re,w as se,E as M,a3 as L,D as N,a4 as V,a5 as _,a6 as A,a7 as U,a8 as Z,q as ye,n as xe,a9 as be,aa as _e}from"./index.904fb14a.js";import{Q as ke}from"./QInput.269eeae8.js";import{Q as $}from"./QCard.5c7dff5f.js";import{Q as Se}from"./QPage.91e185e6.js";import{_ as qe}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as we}from"./QToolbar.60019c25.js";import{Q as D}from"./QCardSection.b9a121b1.js";import{u as Ce,a as Ie}from"./use-dark.33053ea6.js";import{C as Be}from"./ClosePopup.be3b6694.js";import"./use-timeout.a1378caa.js";import"./scroll.8ba91029.js";import"./uid.42677368.js";const I=C(!1);let q=null;const ze=e=>{const a=C(!1),l=window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition;return l&&(a.value=!0,q=new l,q.continuous=!0,q.interimResults=!0,q.lang="fr-FR",q.onerror=function(p){a.value=!1,I.value=!1,console.error("Disabling Speech Recognition because of :",p)}),{showSpeechRecognitionButton:a,toggleSpeechRecognition:()=>{a.value===!1||!q||(I.value?(q.stop(),I.value=!1):(q.onresult=p=>{try{let d="",o="";for(let i=0;i<p.results.length;i++){const f=p.results[i];f.isFinal?d+=f[0].transcript:o+=f[0].transcript}e.value=d+o}catch(d){console.error("Error in speech recognition:",d)}},q.start(),I.value=!0))}}},De={...ee,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},H=50,ie=2*H,ce=ie*Math.PI,Ae=Math.round(ce*1e3)/1e3;var Qe=K({name:"QCircularProgress",props:{...De,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:a}){const{proxy:{$q:l}}=ne(),t=te(e),p=b(()=>{const m=(l.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(l.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-m}deg)`:`rotate3d(0, 0, 1, ${m-90}deg)`}}),d=b(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),o=b(()=>ie/(1-e.thickness/2)),i=b(()=>`${o.value/2} ${o.value/2} ${o.value} ${o.value}`),f=b(()=>ve(e.value,e.min,e.max)),g=b(()=>ce*(1-(f.value-e.min)/(e.max-e.min))),y=b(()=>e.thickness/2*o.value);function k({thickness:m,offset:u,color:S,cls:Q,rounded:n}){return h("circle",{class:"q-circular-progress__"+Q+(S!==void 0?` text-${S}`:""),style:d.value,fill:"transparent",stroke:"currentColor","stroke-width":m,"stroke-dasharray":Ae,"stroke-dashoffset":u,"stroke-linecap":n,cx:o.value,cy:o.value,r:H})}return()=>{const m=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&m.push(h("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:H-y.value/2,cx:o.value,cy:o.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&m.push(k({cls:"track",thickness:y.value,offset:0,color:e.trackColor})),m.push(k({cls:"circle",thickness:y.value,offset:g.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const u=[h("svg",{class:"q-circular-progress__svg",style:p.value,viewBox:i.value,"aria-hidden":"true"},m)];return e.showValue===!0&&u.push(h("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},a.default!==void 0?a.default():[h("div",f.value)])),h("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:t.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:f.value},ae(a.internal,u))}}});const Re=[h("g",{fill:"none","fill-rule":"evenodd","stroke-width":"2"},[h("circle",{cx:"22",cy:"22",r:"1"},[h("animate",{attributeName:"r",begin:"0s",dur:"1.8s",values:"1; 20",calcMode:"spline",keyTimes:"0; 1",keySplines:"0.165, 0.84, 0.44, 1",repeatCount:"indefinite"}),h("animate",{attributeName:"stroke-opacity",begin:"0s",dur:"1.8s",values:"1; 0",calcMode:"spline",keyTimes:"0; 1",keySplines:"0.3, 0.61, 0.355, 1",repeatCount:"indefinite"})]),h("circle",{cx:"22",cy:"22",r:"1"},[h("animate",{attributeName:"r",begin:"-0.9s",dur:"1.8s",values:"1; 20",calcMode:"spline",keyTimes:"0; 1",keySplines:"0.165, 0.84, 0.44, 1",repeatCount:"indefinite"}),h("animate",{attributeName:"stroke-opacity",begin:"-0.9s",dur:"1.8s",values:"1; 0",calcMode:"spline",keyTimes:"0; 1",keySplines:"0.3, 0.61, 0.355, 1",repeatCount:"indefinite"})])])];var Me=K({name:"QSpinnerPuff",props:fe,setup(e){const{cSize:a,classes:l}=he(e);return()=>h("svg",{class:l.value,stroke:"currentColor",width:a.value,height:a.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg"},Re)}});const Ne={__name:"momentSyncIcon",props:{momentId:{required:!0,type:String},expectedLlmCallDuration:{required:!0,type:Number,default:40}},setup(e){const a=e,l=G(),t=C(null),p=C(O.now().seconds);let d;E(async()=>{l.getMomentById(a.momentId,t)}),E(()=>{d=setInterval(()=>{p.value=O.now().seconds},1e3)}),le(()=>{d&&clearInterval(d)});const o=b(()=>{var i,f,g,y,k,m,u;return((i=t.value)==null?void 0:i.needsSatisAndImp)&&Object.keys((f=t.value)==null?void 0:f.needsSatisAndImp).length>0?Object.keys((g=t.value)==null?void 0:g.needsSatisAndImp).every(S=>S==="oops"||S==="error")?"needsAnalyzedWithOops":"needsAnalyzedWithSuccess":navigator!=null&&navigator.onLine?((k=(y=t.value)==null?void 0:y.date)==null?void 0:k.seconds)&&((u=(m=t.value)==null?void 0:m.date)==null?void 0:u.seconds)>p.value-a.expectedLlmCallDuration?"analyzingNeeds":"unknownError":"needsNonAnalyzedAndOffline"});return(i,f)=>o.value==="needsAnalyzedWithOops"?(v(),x(z,{key:0,size:"20px",color:"error-dark",name:"error",class:"q-mx-md"})):o.value==="needsAnalyzedWithSuccess"?(v(),x(z,{key:1,size:"20px",color:"primary",name:"check_circle",class:"q-mx-md"})):o.value==="needsNonAnalyzedAndOffline"?(v(),x(z,{key:2,size:"20px",color:"outline-variant",name:"cloud_off",class:"q-mx-md"})):o.value==="analyzingNeeds"?(v(),x(z,{key:3,size:"20px",class:"q-mx-md"},{default:s(()=>{var g,y;return[c(Qe,{value:(p.value-((y=(g=t.value)==null?void 0:g.date)==null?void 0:y.seconds))*(100/e.expectedLlmCallDuration),size:"20px",color:"primary","track-color":"primary-container",rounded:"",class:"position-absolute centered"},null,8,["value"]),c(Me,{color:"primary",size:"20px",class:"position-absolute centered"})]}),_:1})):(v(),x(z,{key:4,size:"20px",color:"outline-variant",name:"cloud_off",class:"q-mx-md"}))}};var ue=qe(Ne,[["__scopeId","data-v-5781b7db"]]);const Ve={xs:8,sm:10,md:14,lg:20,xl:24};var $e=K({name:"QChip",props:{...Ce,...ee,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:a,emit:l}){const{proxy:{$q:t}}=ne(),p=Ie(e,t),d=te(e,Ve),o=b(()=>e.selected===!0||e.icon!==void 0),i=b(()=>e.selected===!0?e.iconSelected||t.iconSet.chip.selected:e.icon),f=b(()=>e.iconRemove||t.iconSet.chip.remove),g=b(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),y=b(()=>{const n=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(n?` text-${n} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(g.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(p.value===!0?" q-chip--dark q-dark":"")}),k=b(()=>{const n=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},r={...n,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||t.lang.label.remove};return{chip:n,remove:r}});function m(n){n.keyCode===13&&u(n)}function u(n){e.disable||(l("update:selected",!e.selected),l("click",n))}function S(n){(n.keyCode===void 0||n.keyCode===13)&&(ge(n),e.disable===!1&&(l("update:modelValue",!1),l("remove")))}function Q(){const n=[];g.value===!0&&n.push(h("div",{class:"q-focus-helper"})),o.value===!0&&n.push(h(z,{class:"q-chip__icon q-chip__icon--left",name:i.value}));const r=e.label!==void 0?[h("div",{class:"ellipsis"},[e.label])]:void 0;return n.push(h("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},ae(a.default,r))),e.iconRight&&n.push(h(z,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&n.push(h(z,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:f.value,...k.value.remove,onClick:S,onKeyup:S})),n}return()=>{if(e.modelValue===!1)return;const n={class:y.value,style:d.value};return g.value===!0&&Object.assign(n,k.value.chip,{onClick:u,onKeyup:m}),pe("div",n,Q(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[oe,e.ripple]])}}});const Te={class:"q-px-md"},Oe=L("div",{class:"text-weight-medium text-outline col"},"Moment",-1),Le={class:""},Pe=L("div",{class:"text-weight-medium text-outline col"},"Needs",-1),Fe={__name:"momentBottomSheet",props:{modelValue:{required:!0,type:Boolean,default:!1},momentId:{required:!0,type:String},expectedLlmCallDuration:{required:!0,type:Number,default:40}},emits:["update:modelValue"],setup(e){const a=e,l=G(),t=C(null);re(()=>a.momentId,(d,o)=>{l.getMomentById(d,t),console.log("in momentBottomSheet watch props.momentId:",a.momentId,"moment:",t)});const p=d=>d[0]<.4?"red":d[0]>.6?"green":"primary";return(d,o)=>(v(),x(me,{"model-value":e.modelValue,"onUpdate:modelValue":o[0]||(o[0]=i=>d.$emit("update:modelValue",i.target)),position:"bottom","full-width":""},{default:s(()=>[c($,{class:"bg-background",flat:"",style:{height:"90vh"}},{default:s(()=>[c(we,{class:"q-pa-sm"},{default:s(()=>[se(c(M,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Be]])]),_:1}),L("div",Te,[c(W,{class:"q-px-none"},{default:s(()=>[c(T,{class:"text-h6 text-weight-medium"},{default:s(()=>{var i,f;return[N(V(_(l).getFormattedDate((f=(i=t.value)==null?void 0:i.date)==null?void 0:f.seconds,!0)),1)]}),_:1}),c(T,{avatar:"",class:"q-px-none",style:{"min-width":"20px"}},{default:s(()=>[c(ue,{"moment-id":e.momentId,"expected-llm-call-duration":e.expectedLlmCallDuration},null,8,["moment-id","expected-llm-call-duration"])]),_:1})]),_:1}),c($,{class:"bg-surface q-mb-md q-px-md q-py-md",style:{"border-radius":"14px"},flat:""},{default:s(()=>[c(D,{horizontal:"",class:"q-px-none"},{default:s(()=>[Oe]),_:1}),c(D,{class:"q-px-none q-py-sm"},{default:s(()=>{var i;return[L("div",Le,V((i=t.value)==null?void 0:i.text),1)]}),_:1})]),_:1}),c($,{class:"bg-surface q-mb-md q-px-md q-py-md",style:{"border-radius":"14px"},flat:""},{default:s(()=>{var i,f,g,y,k;return[c(D,{horizontal:"",class:"q-px-none"},{default:s(()=>[Pe]),_:1}),((i=t.value)==null?void 0:i.needsSatisAndImp)&&(((f=t.value)==null?void 0:f.needsSatisAndImp.error)||((g=t.value)==null?void 0:g.needsSatisAndImp.oops))?(v(),x(D,{key:0,class:"q-px-none q-py-sm text-error",style:{"min-height":"0px"}},{default:s(()=>{var m,u;return[N(V("Oops: "+(((m=t.value)==null?void 0:m.needsSatisAndImp.error)||((u=t.value)==null?void 0:u.needsSatisAndImp.oops)).replace(/[^a-zA-Z0-9!?,;.:]+$/,""))+" ",1)]}),_:1})):((y=t.value)==null?void 0:y.needsSatisAndImp)&&Object.keys((k=t.value)==null?void 0:k.needsSatisAndImp).length>0?(v(),x(D,{key:1,class:"q-px-none q-py-sm chip-container",style:{"min-height":"0px"}},{default:s(()=>{var m;return[(v(!0),A(U,null,Z(Object.entries((m=t.value)==null?void 0:m.needsSatisAndImp).sort(([,u],[,S])=>S[1]-u[1]),u=>(v(),x($e,{key:u[0],outline:"",color:p(u[1]),icon:_(l).needsMap[u[0]],label:u[0],class:"needs"},null,8,["color","icon","label"]))),128))]}),_:1})):(v(),x(D,{key:2,class:"q-px-none q-py-sm text-error",style:{"min-height":"0px"}}))]}),_:1})])]),_:1})]),_:1},8,["model-value"]))}};const je={key:0},We={key:1},j="Feeling...when/at/to...bec...",lt={__name:"HomeTab",setup(e){const a=G();E(async()=>{try{a.momentsFetched||await a.fetchMoments()}catch(r){console.error("await momentsStore.fetchMoments() error:",r)}}),ye(()=>{l.value&&t.value.length>0&&l.value.focus()}),xe(()=>{q&&(q.stop(),I.value=!1)}),le(()=>{q&&(q.stop(),I.value=!1)});const l=C(null),t=C(""),p=C(null),d=C(40),o=C(!1),i=C(""),f=r=>{console.log("in openBottomSheet momentId:",r),i.value=r,o.value=!0},g=()=>{l.value.resetValidation()},y=b(()=>t.value.length===0?j:j.indexOf(t.value)!==0?"":j.split(t.value).slice(1).join(t.value)),k=/^(?=(?:[^A-Za-z0-9]*[A-Za-z0-9]){4})/,m=[r=>r&&r.length>0||"That's short \u{1F60A}, can you add more details?",r=>r&&r.length<1e3||"Whoa! \u{1F604} That's a lot to take in. Can you split it into two moments?",r=>r&&r.split(/\s+/).filter(B=>B.length>0).length>=4||"That's short \u{1F60A}, can you add more details?",r=>r&&k.test(r)||"Oops! \u{1F605} Got a bit lost there. Can you rephrase that for me?"],{showSpeechRecognitionButton:u,toggleSpeechRecognition:S}=ze(t);re(I,r=>{r||l.value.$el.querySelector("textarea").select()});const Q=r=>{if(r.preventDefault(),l.value.validate(),l.value.hasError){l.value.focus();return}p.value=O.now(),a.addMoment({date:p.value,text:t.value.trim()}),t.value="",p.value=null},n=r=>{var P,X;const B=new O(r,0).toDate(),w=(X=(P=a==null?void 0:a.momentsColl)==null?void 0:P.value)==null?void 0:X.filter(F=>_e.isSameDate(F.date.toDate(),B,"day"));return w==null?void 0:w.sort((F,de)=>de.date.seconds-F.date.seconds)};return(r,B)=>(v(),x(Se,{class:"q-mx-auto q-pa-md",style:{"max-width":"600px"}},{default:s(()=>[c(Y,{class:"text-body1 text-weight-medium q-my-sm"},{default:s(()=>[N("Add a new Moment")]),_:1}),c($,{class:"bg-surface q-mb-lg q-px-none q-py-sm rounded-borders-14",flat:""},{default:s(()=>[c(ke,{"data-cy":"new-moment-textarea",ref_key:"newMomInputRef",ref:l,modelValue:t.value,"onUpdate:modelValue":B[0]||(B[0]=w=>t.value=w),"shadow-text":y.value,"lazy-rules":"ondemand",rules:m,onBlur:g,class:"q-ma-md q-pb-none text-body1",type:"text",autogrow:"",rounded:"",outlined:"","bg-color":"surface-variant",color:"transparent"},{append:s(()=>[_(u)&&!_(I)?(v(),x(M,{key:0,color:"primary",flat:"",dense:"",round:"",icon:"mic",onClick:_(S)},null,8,["onClick"])):_(u)&&_(I)?(v(),x(M,{key:1,color:"primary",dense:"",round:"",icon:"stop",class:"pulse-animation",onClick:_(S)},null,8,["onClick"])):be("",!0)]),after:s(()=>[t.value.length!==0&&!_(I)?(v(),x(M,{key:0,onClick:Q,round:"",dense:"",unelevated:"",color:"primary",icon:"arrow_forward"})):(v(),x(M,{key:1,round:"",dense:"",unelevated:"",color:"primary",disable:"",icon:"arrow_forward"}))]),_:1},8,["modelValue","shadow-text"])]),_:1}),!_(a)||!_(a).uniqueDays||_(a).uniqueDays.length==0?(v(),A("div",je)):(v(),A("div",We,[c(J,null,{default:s(()=>[(v(!0),A(U,null,Z(_(a).uniqueDays,w=>(v(),A("div",{key:w},[c(Y,{header:"",class:"text-body1 text-weight-medium text-on-background q-pa-none q-mt-lg q-mb-sm"},{default:s(()=>[N(V(_(a).getFormattedDate(w)),1)]),_:2},1024),c(W,{class:"bg-surface q-mb-md q-px-none q-py-none rounded-borders-14"},{default:s(()=>[c(J,{"full-width":"",style:{width:"100%"}},{default:s(()=>[(v(!0),A(U,null,Z(n(w),R=>se((v(),x(W,{key:R.id,clickable:"",class:"q-px-none q-py-md",style:{"min-height":"0px"},onClick:P=>f(R.id)},{default:s(()=>[c(T,{avatar:"",top:"",class:"q-px-none",style:{"min-width":"20px"}},{default:s(()=>[c(ue,{"moment-id":R.id,"expected-llm-call-duration":d.value},null,8,["moment-id","expected-llm-call-duration"])]),_:2},1024),c(T,{class:"q-pb-none q-pl-none q-pr-md"},{default:s(()=>[N(V(R.text),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[oe]])),128))]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),c(Fe,{modelValue:o.value,"onUpdate:modelValue":B[1]||(B[1]=w=>o.value=w),"moment-id":i.value,"expected-llm-call-duration":d.value},null,8,["modelValue","moment-id","expected-llm-call-duration"])]))]),_:1}))}};export{lt as default};
